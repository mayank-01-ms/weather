const metaTheme=document.querySelector("meta[name = 'theme-color']"),background=document.getElementById("background"),welcomeScreen=document.getElementById("welcome"),loadingScreen=document.getElementById("loading"),weatherArea=document.getElementById("weather"),locationArea=document.getElementById("location");weatherArea.style.display="none";const hiddenfcArea=document.querySelector(".hidden-fc"),expandfcArea=document.querySelector(".expand-fc");expandfcArea.addEventListener("click",()=>{"none"===hiddenfcArea.style.display?(hiddenfcArea.style.display="block",expandfcArea.style.borderTop="1px solid var(--border)",expandfcArea.innerHTML="Hide rows"):"block"===hiddenfcArea.style.display&&(hiddenfcArea.style.display="none",expandfcArea.style.borderTop="none",expandfcArea.innerHTML="Show 4 more rows")});let date=new Date,addDays=e=>{let t=new Date;return t.setDate(t.getDate()+e),t};const firstdaymm=document.getElementById("fc-firstday"),seconddaymm=document.getElementById("fc-secondday"),thirddaymm=document.getElementById("fc-thirdday"),fourthdaymm=document.getElementById("fc-fourthday"),fifthdaymm=document.getElementById("fc-fifthday"),sixthdaymm=document.getElementById("fc-sixthday"),seventhdaymm=document.getElementById("fc-seventhday"),fcfirstimg=document.getElementById("fc-firstimg"),fcssecondimg=document.getElementById("fc-secondimg"),fcthirdimg=document.getElementById("fc-thirdimg"),fcfourthimg=document.getElementById("fc-fourthimg"),fcfifthimg=document.getElementById("fc-fifthimg"),fcsixthimg=document.getElementById("fc-sixthimg"),fcseventhimg=document.getElementById("fc-seventhimg"),temperatureArea=document.getElementById("current-temperature"),windSpeed=document.getElementById("wind-speed"),feelsLike=document.getElementById("feels-like"),humidity=document.getElementById("humidity"),uvIndex=document.getElementById("uv-index"),sunrise=document.getElementById("sunrise"),sunset=document.getElementById("sunset"),pressure=document.getElementById("pressure"),visibility=document.getElementById("visibility"),dateArea=document.getElementById("date");dateArea.innerHTML=date.toLocaleDateString();const status=document.getElementById("status"),description=document.getElementById("description"),thirdDay=document.getElementById("third-day-date"),fourthDay=document.getElementById("fourth-day-date"),fifthDay=document.getElementById("fifth-day-date"),sixthDay=document.getElementById("sixth-day-date"),seventhDay=document.getElementById("seventh-day-date");thirdDay.innerHTML=addDays(2).toDateString().slice(0,-5),fourthDay.innerHTML=addDays(3).toDateString().slice(0,-5),fifthDay.innerHTML=addDays(4).toDateString().slice(0,-5),sixthDay.innerHTML=addDays(5).toDateString().slice(0,-5),seventhDay.innerHTML=addDays(6).toDateString().slice(0,-5);const windSpeedLogo=document.querySelector(".wind-speed-logo"),weatherIcon=document.querySelector(".weather-icon");let createStars=()=>{for(let e=0;e<80;e++){let t=document.createElement("span");t.classList.add("twinkle"),t.style.top=100*Math.random()+"vh",t.style.left=100*Math.random()+"vw",t.style.height=t.style.width=1+2*Math.random()+"px",t.style.animationDelay=1+4*Math.random()+"s",background.append(t)}},createSnow=()=>{for(let e=0;e<70;e++){let t=document.createElement("span");t.classList.add("snowflake"),t.style.top=100*Math.random()+"vh",t.style.left=90*Math.random()+"vw",t.style.height=t.style.width=5+10*Math.random()+"px",t.style.animationDuration=1+4*Math.random()+"s",t.style.fontSize=.75+.5*Math.random()+"rem",t.style.opacity=.5+Math.random(),background.append(t)}},createClouds=()=>{for(let e=0;e<5;e++){let t=document.createElement("span");t.classList.add("clouds"),t.style.top=0+20*Math.random()+"vh",t.style.left=5+5*Math.random()+"vw",t.style.animationDuration=7+10*Math.random()+"s",t.style.transform=`scale(${.2+Math.random()})`,t.style.opacity=.5+.5*Math.random(),background.append(t)}},createRain=()=>{for(let e=0;e<100;e++){let t=document.createElement("span");t.classList.add("raindrop"),t.style.top=100*Math.random()+"vh",t.style.left=100*Math.random()+"vw",t.style.height=10+15*Math.random()+"px",t.style.width=1+1*Math.random()+"px",t.style.animationDuration=1+1*Math.random()+"s",background.append(t)}},createFog=()=>{for(let e=0;e<20;e++){let t=document.createElement("span");t.classList.add("fog"),t.style.top=2+50*Math.random()+"vh",t.style.left=100*Math.random()+"vw",t.style.height=120+10*Math.random()+"px",t.style.width=60+10*Math.random()+"px",t.style.margin=2+5*Math.random()+"px",t.style.animationDelay=-10+4*Math.random()+"s",t.style.animationDuration=10+10*Math.random()+"s",background.append(t)}},createThunder=()=>{let e=document.createElement("div");e.classList.add("thunder"),background.append(e)},snowWeather=()=>{createSnow(),background.classList.add("snow");let e=document.createElement("div");e.classList.add("snow-flake-icon"),weatherIcon.append(e),metaTheme.setAttribute("content","#2395ff")},clearWeather=(e="day")=>{background.classList.add("clear");let t=document.createElement("div");t.classList.add("sun");let a=document.createElement("div");a.classList.add("flare-one");let n=document.createElement("div");n.classList.add("flare-two");let r=document.createElement("div");if(r.classList.add("flare-three"),t.append(a),t.append(n),t.append(r),weatherIcon.append(t),metaTheme.setAttribute("content","#5896fd"),"night"==e){background.classList.add("night"),createStars(),metaTheme.setAttribute("content","#021a48"),t.remove();let d=document.createElement("div");d.classList.add("moon"),weatherIcon.append(d)}},fogWeather=()=>{background.classList.add("foggy"),createFog(),metaTheme.setAttribute("content","#333")},rainWeather=()=>{background.classList.add("rainy"),createRain(),metaTheme.setAttribute("content","#616161")},thunderWeather=()=>{background.classList.add("rainy"),createRain(),createThunder(),metaTheme.setAttribute("content","#616161")},cloudyWeather=()=>{background.classList.add("cloudy"),createClouds(),metaTheme.setAttribute("content","#63a4ff")},convertTimestamptoTime=e=>{let t=new Date(1e3*e),a=t.getHours(),n=a>=12?"PM":"AM";a=(a=0==a?12:a)>12?a-12:a;let r=t.getMinutes();return a+":"+(r=r<10?"0"+r:r)+" "+n},isdayorNight=(e,t)=>{let a=new Date(1e3*e),n=new Date(1e3*t);return date.getTime()>=a.getTime()&&date.getTime()<=n.getTime()?"day":"night"},getWeatherIcon=e=>{if("Fog"==e||"Mist"==e||"Smoke"==e||"Haze"==e)return"fog.png";if("Snow"==e)return"snow.png";if("Rain"==e||"Drizzle"==e)return"rain.png";if("Thunderstorm"==e)return"thunder.png";if("Clear"==e);else if("Clouds"==e)return"clouds.png";return"sun.png"},updateWeather=e=>{let t=localStorage.getItem("temperatureUnit");t||(t="C");(e=>{let a=document.querySelector(".hourly-forecast ul");for(let n=0;n<24;n++){let r=document.createElement("li"),d=document.createElement("div");d.classList.add("h-wdesc"),d.innerHTML=e[n].weather[0].main;let i=document.createElement("div");i.classList.add("h-wicon");let s=document.createElement("img");s.src="images/"+getWeatherIcon(e[n].weather[0].main),i.append(s);let l=document.createElement("div");l.classList.add("h-wtemp"),l.innerHTML=Math.round(e[n].temp)+`&deg; ${t}`;let o=document.createElement("div");o.classList.add("h-wts"),o.innerHTML=convertTimestamptoTime(e[n].dt),r.append(d),r.append(i),r.append(l),r.append(o),a.append(r)}})(e.hourly),loadingScreen.style.display="none",weatherArea.style.display="block",temperatureArea.innerHTML=Math.round(e.current.temp)+`<span class="units">&deg; ${t}</span>`,status.innerHTML=e.current.weather[0].main,description.innerHTML=e.current.weather[0].description,firstdaymm.innerHTML=Math.round(e.daily[0].temp.max)+" / "+Math.round(e.daily[0].temp.min),seconddaymm.innerHTML=Math.round(e.daily[1].temp.max)+" / "+Math.round(e.daily[1].temp.min),thirddaymm.innerHTML=Math.round(e.daily[2].temp.max)+" / "+Math.round(e.daily[2].temp.min),fourthdaymm.innerHTML=Math.round(e.daily[3].temp.max)+" / "+Math.round(e.daily[3].temp.min),fifthdaymm.innerHTML=Math.round(e.daily[4].temp.max)+" / "+Math.round(e.daily[4].temp.min),sixthdaymm.innerHTML=Math.round(e.daily[5].temp.max)+" / "+Math.round(e.daily[5].temp.min),seventhdaymm.innerHTML=Math.round(e.daily[6].temp.max)+" / "+Math.round(e.daily[6].temp.min),fcfirstimg.src="images/"+getWeatherIcon(e.daily[0].weather[0].main),fcssecondimg.src="images/"+getWeatherIcon(e.daily[1].weather[0].main),fcthirdimg.src="images/"+getWeatherIcon(e.daily[2].weather[0].main),fcfourthimg.src="images/"+getWeatherIcon(e.daily[3].weather[0].main),fcfifthimg.src="images/"+getWeatherIcon(e.daily[4].weather[0].main),fcsixthimg.src="images/"+getWeatherIcon(e.daily[5].weather[0].main),fcseventhimg.src="images/"+getWeatherIcon(e.daily[6].weather[0].main),windSpeed.innerHTML=e.current.wind_speed+" KM/H",windSpeedLogo.style.transform=`rotate(${-(e.current.wind_deg+90)}deg)`,feelsLike.innerHTML=Math.round(e.current.feels_like)+`&deg; ${t}`,humidity.innerHTML=e.current.humidity+" %",uvIndex.innerHTML=e.current.uvi,sunrise.innerHTML=convertTimestamptoTime(e.current.sunrise),sunset.innerHTML=convertTimestamptoTime(e.current.sunset),pressure.innerHTML=e.current.pressure+" hPa",visibility.innerHTML=e.current.visibility/1e3+" KM";let a=e.current.weather[0].main;"Fog"==a||"Mist"==a||"Smoke"==a||"Haze"==a?fogWeather():"Snow"==a?snowWeather():"Rain"==a||"Drizzle"==a?rainWeather():"Thunderstorm"==a?thunderWeather():"Clear"==a?clearWeather(isdayorNight(e.current.sunrise,e.current.sunset)):"Clouds"==a&&cloudyWeather()},setCityName=(e,t)=>{fetch(`https://us1.locationiq.com/v1/reverse.php?key=pk.605dd685238cf7692646fed54a9edd35&lat=${e}&lon=${t}+&format=json`).then(e=>{if(200!==e.status)return"";e.json().then(e=>{let t=e.address.city;void 0==t&&(t=e.address.county),void 0==t&&(t=e.address.state);let a=localStorage.getItem("cityName");null==a?locationArea.innerHTML=t+", ":a==t?locationArea.innerHTML=t+", ":locationArea.innerHTML=a+", "+t+", "})})},fetchWeather=(e,t)=>{loadingScreen.style.display="block";let a=localStorage.getItem("temperatureUnit");fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${e}&lon=${t}&units=${a=a?"C"==a?"metric":"imperial":"metric"}&appid=359ebc3913cdfaf3cda4d3a5a728049e`).then(e=>{if(weatherArea.style.display="block",200!==e.status){console.log("Looks like there was a problem. Status Code: "+e.status);return}e.json().then(e=>{updateWeather(e)})}).catch(e=>{console.log("Fetch Error :",e)})},getCityPopup=()=>{let e=localStorage.getItem("latitude"),t=localStorage.getItem("longitude");null==e||null==t?welcomeScreen.style.display="flex":(setCityName(e,t),fetchWeather(e,t))},startApp=()=>{metaTheme.setAttribute("content","#FC466B");let e=localStorage.getItem("useGPS");(!e||"true"==e)&&navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let t=e.coords.latitude,a=e.coords.longitude;localStorage.removeItem("latitude"),localStorage.removeItem("longitude"),localStorage.removeItem("cityName"),setCityName(t,a),fetchWeather(t,a)},()=>{getCityPopup()}):getCityPopup()};startApp();const form=document.querySelector("#welcome form");form.addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("city").value.trim();fetch(`https://us1.locationiq.com/v1/search.php?key=pk.605dd685238cf7692646fed54a9edd35&format=json&q=${t}`).then(e=>{if(200!==e.status){let a=document.getElementById("err-c-msg");a.innerHTML="* Invalid city. Please enter a valid city."}e.json().then(e=>{let a=e[0].lat,n=e[0].lon;localStorage.setItem("latitude",a),localStorage.setItem("longitude",n),localStorage.setItem("cityName",t),welcomeScreen.style.display="none",setCityName(a,n),fetchWeather(a,n)})})});
